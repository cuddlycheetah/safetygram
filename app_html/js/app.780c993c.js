(function(e){function t(t){for(var a,o,s=t[0],l=t[1],c=t[2],d=0,v=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&v.push(i[o][0]),i[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);u&&u(t);while(v.length)v.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(a=!1)}a&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},i={app:0},r=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"1a88":function(e,t,n){},"22de":function(e,t,n){"use strict";var a=n("88fe"),i=n.n(a);i.a},"4abe":function(e,t){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"peer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"peer"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MongoID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"name"},name:{kind:"Name",value:"chatNamesetOne"},arguments:[{kind:"Argument",name:{kind:"Name",value:"sort"},value:{kind:"EnumValue",value:"_ID_DESC"}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"chat"},value:{kind:"Variable",name:{kind:"Name",value:"peer"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:111}};n.loc.source={body:"query peer ($peer: MongoID!) {\n  name: chatNamesetOne(sort:_ID_DESC, filter: { chat: $peer }) {\n    name\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}var i={};function r(e,t){for(var n=0;n<e.definitions.length;n++){var a=e.definitions[n];if(a.name&&a.name.value==t)return a}}function o(e,t){var n={kind:e.kind,definitions:[r(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;a.forEach((function(e){s.add(e)}));while(s.size>0){var l=s;s=new Set,l.forEach((function(e){if(!o.has(e)){o.add(e);var t=i[e]||new Set;t.forEach((function(e){s.add(e)}))}}))}return o.forEach((function(t){var a=r(e,t);a&&n.definitions.push(a)})),n}(function(){n.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),i[e.name.value]=t}}))})(),e.exports=n,e.exports["peer"]=o(n,"peer")},"4ada":function(e,t){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"peer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"peer"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MongoID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"name"},name:{kind:"Name",value:"userNamesetOne"},arguments:[{kind:"Argument",name:{kind:"Name",value:"sort"},value:{kind:"EnumValue",value:"_ID_DESC"}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"user"},value:{kind:"Variable",name:{kind:"Name",value:"peer"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:129}};n.loc.source={body:"query peer ($peer: MongoID!) {\n  name: userNamesetOne(sort:_ID_DESC, filter: { user: $peer }) {\n    firstName\n    lastName\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}var i={};function r(e,t){for(var n=0;n<e.definitions.length;n++){var a=e.definitions[n];if(a.name&&a.name.value==t)return a}}function o(e,t){var n={kind:e.kind,definitions:[r(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;a.forEach((function(e){s.add(e)}));while(s.size>0){var l=s;s=new Set,l.forEach((function(e){if(!o.has(e)){o.add(e);var t=i[e]||new Set;t.forEach((function(e){s.add(e)}))}}))}return o.forEach((function(t){var a=r(e,t);a&&n.definitions.push(a)})),n}(function(){n.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),i[e.name.value]=t}}))})(),e.exports=n,e.exports["peer"]=o(n,"peer")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("router-view")},r=[],o={},s=o,l=n("2877"),c=Object(l["a"])(s,i,r,!1,null,null,null),u=c.exports,d=(n("45fc"),n("8c4f")),v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{attrs:{id:"inspire"}},[n("v-content",[n("v-container",{staticClass:"fill-height",attrs:{fluid:""}},[n("v-row",{attrs:{align:"center",justify:"center"}},[n("v-col",{attrs:{cols:"12",sm:"8",md:"4"}},[n("v-card",{staticClass:"elevation-12"},[n("v-toolbar",{attrs:{color:"primary",dark:"",flat:""}},[n("v-toolbar-title",[e._v("Safetygram")]),n("v-spacer"),n("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[n("v-btn",e._g({attrs:{href:"https://github.com/cuddlycheetah/safetygram",icon:"",large:"",target:"_blank"}},a),[n("svg",{staticStyle:{width:"24px",height:"24px"},attrs:{viewBox:"0 0 24 24"}},[n("path",{attrs:{fill:"#000000",d:"M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"}})])])]}}])},[n("span",[e._v("Source Code")])])],1),n("v-card-text",[n("v-form",{on:{submit:[e.login,function(t){return t.preventDefault(),e.send(t)}]}},[n("v-text-field",{attrs:{id:"password",label:"Password","prepend-icon":"lock",type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e.error?n("div",{staticClass:"alert alert-danger"},[n("p",[e._v(e._s(e.error))])]):e._e()],1)],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{type:"submit",color:"primary"},on:{click:e.login}},[e._v("Login")])],1)],1)],1)],1)],1)],1)],1)},p=[],m=n("bc3a"),f=n.n(m),h={name:"Login",props:{source:String},data:function(){return{password:"",error:""}},methods:{login:function(){var e=this;f.a.post("/api/login",{password:this.password}).then((function(e){200===e.status&&(localStorage.setItem("token",e.data),Ft.push("/"))}),(function(t){console.log(t.response),e.error=t.response.data}))}}},g=h,b=n("6544"),_=n.n(b),y=n("7496"),k=n("8336"),w=n("b0af"),C=n("99d9"),S=n("62ad"),V=n("a523"),x=n("a75b"),O=n("4bd4"),N=n("0fd9"),I=n("2fa4"),P=n("8654"),$=n("71d9"),j=n("2a7f"),E=n("3a2f"),D=Object(l["a"])(g,v,p,!1,null,null,null),L=D.exports;_()(D,{VApp:y["a"],VBtn:k["a"],VCard:w["a"],VCardActions:C["a"],VCardText:C["b"],VCol:S["a"],VContainer:V["a"],VContent:x["a"],VForm:O["a"],VRow:N["a"],VSpacer:I["a"],VTextField:P["a"],VToolbar:$["a"],VToolbarTitle:j["a"],VTooltip:E["a"]});var T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{attrs:{id:"keep"}},[n("v-app-bar",{attrs:{app:"","clipped-left":"",color:"blue"}},[n("v-app-bar-nav-icon",{on:{click:function(t){e.drawer=!e.drawer}}}),n("span",{staticClass:"title ml-3 mr-5"},[e._v(" Safetygram "),n("span",{staticClass:"font-weight-light"},[e._v("Beta")])]),n("v-text-field",{attrs:{"solo-inverted":"",flat:"","hide-details":"",label:"Search","prepend-inner-icon":"search"}}),n("v-spacer")],1),n("v-navigation-drawer",{attrs:{app:"",clipped:"",color:"grey lighten-4"},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[n("v-list",{staticClass:"grey lighten-4",attrs:{dense:""}},[e._l(e.items,(function(t,a){return[t.heading?n("v-row",{key:a,attrs:{align:"center"}},[n("v-col",{attrs:{cols:"6"}},[t.heading?n("v-subheader",[e._v(e._s(t.heading))]):e._e()],1)],1):t.divider?n("v-divider",{key:a,staticClass:"my-4",attrs:{dark:""}}):n("v-list-item",{key:a,attrs:{link:"",to:t.link}},[n("v-list-item-action",[n("v-icon",[e._v(e._s(t.icon))])],1),n("v-list-item-content",[n("v-list-item-title",{staticClass:"grey--text"},[e._v(e._s(t.text))])],1)],1)]})),n("v-divider",{staticClass:"my-4",attrs:{dark:""}}),n("v-list-item",{attrs:{link:""},on:{click:function(t){return e.logout()}}},[n("v-list-item-action",[n("v-icon",[e._v("logout")])],1),n("v-list-item-content",[n("v-list-item-title",{staticClass:"grey--text"},[e._v("Logout")])],1)],1)],2)],1),n("v-content",[n("router-view")],1)],1)},A=[],F={props:{source:String},data:function(){return{drawer:null,items:[{icon:"dashboard",text:"Dashboard",link:"/"},{icon:"developer_mode",text:"Raw Query Interface",link:"/rqi"},{divider:!0},{icon:"chat",text:"Chats",link:"/chats"},{icon:"delete",text:"Deleted Messages",link:"/deletedmsgs"},{divider:!0},{icon:"settings",text:"Settings",link:"/settings"},{icon:"help",text:"Help",link:"/help"}]}},created:function(){null===localStorage.getItem("token")&&this.$router.push("/login")},mounted:function(){},methods:{logout:function(){localStorage.clear(),this.$router.push("/login")}}},M=F,q=(n("22de"),n("40dc")),R=n("5bc1"),U=n("ce7e"),z=n("132d"),B=n("8860"),H=n("da13"),Q=n("1800"),G=n("5d23"),J=n("f774"),W=n("e0c7"),Z=Object(l["a"])(M,T,A,!1,null,null,null),K=Z.exports;_()(Z,{VApp:y["a"],VAppBar:q["a"],VAppBarNavIcon:R["a"],VCol:S["a"],VContent:x["a"],VDivider:U["a"],VIcon:z["a"],VList:B["a"],VListItem:H["a"],VListItemAction:Q["a"],VListItemContent:G["a"],VListItemTitle:G["c"],VNavigationDrawer:J["a"],VRow:N["a"],VSpacer:I["a"],VSubheader:W["a"],VTextField:P["a"]});var X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{staticClass:"grey lighten-5"},[n("v-row",[n("v-col",{attrs:{cols:"12",xs:"12",sm:"4",md:"3"}},[n("v-card",{directives:[{name:"ripple",rawName:"v-ripple"}]},[n("v-card-title",[e._v("Database Size:")]),n("v-card-text",[e._v(e._s(e.stats.totalDBSize)+" MB")])],1)],1),n("v-col",{attrs:{cols:"12",xs:"12",sm:"4",md:"3"}},[n("v-card",{directives:[{name:"ripple",rawName:"v-ripple"}]},[n("v-card-title",[e._v("Chats:")]),n("v-card-text",[e._v(e._s(e.stats.chats))])],1)],1),n("v-col",{attrs:{cols:"12",xs:"12",sm:"4",md:"3"}},[n("v-card",{directives:[{name:"ripple",rawName:"v-ripple"}]},[n("v-card-title",[e._v("Users:")]),n("v-card-text",[e._v(e._s(e.stats.users))])],1)],1),n("v-col",{attrs:{cols:"12",xs:"12",sm:"4",md:"3"}},[n("v-card",{directives:[{name:"ripple",rawName:"v-ripple"}]},[n("v-card-title",[e._v("Deleted Messages:")]),n("v-card-text",[e._v(e._s(e.stats.messagesDeleted)+" / "+e._s(e.stats.messages)+" total Messages")])],1)],1)],1),n("v-bottom-sheet",{attrs:{persistent:"",fullscreen:""},model:{value:e.showSetupHint,callback:function(t){e.showSetupHint=t},expression:"showSetupHint"}},[n("v-sheet",{staticClass:"text-center",attrs:{height:"200px"}},[n("div",{staticClass:"py-3"},[e._v(" Telegram has not been configured yet. Please follow the Setup. ")]),n("v-btn",{staticClass:"mt-6",attrs:{color:"error",to:"/setup"}},[e._v("Setup")])],1)],1)],1)},Y=[],ee=n("8785"),te=n("9530"),ne=n.n(te);function ae(){var e=Object(ee["a"])(["{\n  stats {\n    chats\n    users\n    messages\n    messagesDeleted\n    files\n    totalDBSize\n    totalArchiveSize\n    telegramStatus\n  }\n}"]);return ae=function(){return e},e}var ie=ne()(ae()),re={name:"Dashboard",apollo:{stats:{query:ie,pollInterval:1e3}},computed:{showSetupHint:function(){return!!this.stats&&"authorizationStateReady"!==this.stats.telegramStatus}}},oe=re,se=n("288c"),le=n("8dd9"),ce=n("269a"),ue=n.n(ce),de=n("5607"),ve=Object(l["a"])(oe,X,Y,!1,null,null,null),pe=ve.exports;_()(ve,{VBottomSheet:se["a"],VBtn:k["a"],VCard:w["a"],VCardText:C["b"],VCardTitle:C["c"],VCol:S["a"],VContainer:V["a"],VRow:N["a"],VSheet:le["a"]}),ue()(ve,{Ripple:de["a"]});var me=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat-overview"},[n("v-list",{attrs:{"three-line":""}},[this.$apollo.queries.chatOverview.loading?n("v-skeleton-loader",{staticClass:"mx-auto",attrs:{type:"list-item-avatar-three-line,list-item-avatar-three-line,list-item-avatar-three-line,list-item-avatar-three-line,list-item-avatar-three-line,list-item-avatar-three-line,list-item-avatar-three-line,list-item-avatar-three-line,list-item-avatar-three-line,list-item-avatar-three-line,list-item-avatar-three-line"}}):e._e(),e._l(e.chatOverview,(function(t){return[n("v-list-item",{key:t._id,attrs:{to:"/chats/"+t._id}},[n("v-list-item-avatar",[n("v-img",{attrs:{src:"/api/file/"+t.photo}})],1),n("v-list-item-content",[n("v-list-item-title",{domProps:{innerHTML:e._s(t.name)}})],1)],1)]}))],2)],1)},fe=[];function he(){var e=Object(ee["a"])(["{\n  chatOverview {\n    _id\n    type\n    name\n    photo\n    user\n  }\n}"]);return he=function(){return e},e}var ge=ne()(he()),be={apollo:{chatOverview:{query:ge,pollInterval:5e3}}},_e=be,ye=n("adda"),ke=n("8270"),we=n("3129"),Ce=Object(l["a"])(_e,me,fe,!1,null,null,null),Se=Ce.exports;_()(Ce,{VImg:ye["a"],VList:B["a"],VListItem:H["a"],VListItemAvatar:ke["a"],VListItemContent:G["a"],VListItemTitle:G["c"],VSkeletonLoader:we["a"]});var Ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-flex",[a("v-toolbar",[a("v-toolbar-title",[a("ApolloQuery",{attrs:{query:n("4abe"),variables:{peer:e.$route.params.id}},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.result,i=n.loading,r=n.error,o=n.data;return[i?a("div",{staticClass:"loading apollo"},[e._v("Loading Name...")]):r?a("div",{staticClass:"error apollo"},[e._v("An error occurred")]):o?a("div",{staticClass:"result apollo"},[e._v(e._s(o.name.name))]):a("div",{staticClass:"no-result apollo"},[e._v(e._s(e.$route.params.id))])]}}])})],1),a("v-spacer"),a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-width":200,"offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("v-btn",e._g({attrs:{icon:"",color:"primary",dark:""}},n),[a("v-icon",[e._v("menu")])],1)]}}])},[a("v-card",[a("v-list",[a("v-list-item",[a("v-list-item-avatar",[a("v-img",{attrs:{src:"/api/file/"+e.chatInfo.photo}})],1),a("v-list-item-content",[a("v-list-item-title",[e._v("John Leider")]),a("v-list-item-subtitle",[e._v("Founder of Vuetify.js")])],1)],1)],1),a("v-divider"),a("v-list",[a("v-list-item",[a("v-list-item-action",[a("v-switch",{attrs:{color:"purple"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1),a("v-list-item-title",[e._v("Enable messages")])],1),a("v-list-item",[a("v-list-item-action",[a("v-switch",{attrs:{color:"purple"},model:{value:e.hints,callback:function(t){e.hints=t},expression:"hints"}})],1),a("v-list-item-title",[e._v("Enable hints")])],1),a("v-btn",{attrs:{text:""},on:{click:e.importChat}},[e._v("ImportChat")])],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{text:""},on:{click:function(t){e.menu=!1}}},[e._v("Cancel")]),a("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){e.menu=!1}}},[e._v("Save")])],1)],1)],1)],1),a("div",{staticClass:"chat-container infinite-wrapper"},[a("infinite-loading",{attrs:{"force-use-infinite-wrapper":".infinite-wrapper",direction:"top"},on:{infinite:e.infiniteHandler}}),a("div",{staticStyle:{display:"flex","flex-direction":"column-reverse"}},e._l(e.chatMsgs,(function(t,i){var r;return a("div",{key:i,staticClass:"message",class:(r={own:t.isOutgoing,deleted:t.deleted},r[t.content._]=!0,r)},[i>0&&e.chatMsgs[i+1]&&e.chatMsgs[i+1].from!=t.from||i==e.chatMsgs.length?a("div",{staticClass:"username"},[a("ApolloQuery",{attrs:{query:"User"==t.fromType?n("4ada"):n("4abe"),variables:{peer:t.from}},scopedSlots:e._u([{key:"default",fn:function(n){var i=n.result,r=i.loading,o=i.error,s=i.data;return[r?a("div",{staticClass:"loading apollo"},[e._v("Loading Name...")]):o?a("div",{staticClass:"error apollo"},[e._v("An error occurred")]):s?a("div",{staticClass:"result apollo"},[e._v(e._s(s.name.name||s.name.firstName+" "+s.name.lastName))]):a("div",{staticClass:"no-result apollo"},[e._v(e._s(t.from))])]}}],null,!0)})],1):e._e(),a("div",{staticStyle:{"margin-top":"5px"}}),a("div",{staticClass:"content"},["messageText"===t.content._?a("div",{domProps:{textContent:e._s(t.content.text.text)}}):"messagePhoto"===t.content._?a("div",[a("v-img",{attrs:{src:"/api/file/"+t.contentFiles[1]}})],1):"messageSticker"===t.content._?a("div",[a("img",{attrs:{src:"/api/file/"+t.contentFiles[0]}})]):"messageVoiceNote"===t.content._?a("div",[a("audio",{attrs:{src:"/api/file/"+t.contentFiles[0],controls:""}})]):"messageVideoNote"===t.content._?a("div",[a("video",{attrs:{controls:"",poster:"/api/file/"+t.contentFiles[0],src:"/api/file/"+t.contentFiles[1]}})]):"messageAnimation"===t.content._?a("div",[a("video",{attrs:{loop:"",autoplay:"",controls:"",poster:"/api/file/"+t.contentFiles[0],src:"/api/file/"+t.contentFiles[1]}})]):"messageVideo"===t.content._?a("div",[a("video",{attrs:{controls:"",poster:"/api/file/"+t.contentFiles[0],src:"/api/file/"+(t.contentFiles[1]||t.contentFiles[0])}})]):a("div",{domProps:{innerHTML:e._s(t.content)}})])])})),0)],1)],1)},xe=[],Oe=(n("99af"),n("2909")),Ne=n("e166"),Ie=n.n(Ne);function Pe(){var e=Object(ee["a"])(["\n  query chatInfo($chatid: MongoID!) {\n    chatInfo: chatOne(filter: { _id: $chatid }) {\n      storageLevel\n      type\n      lastUpdate\n      user\n      basicGroupId\n      supergroupId \n    }\n  }\n"]);return Pe=function(){return e},e}function $e(){var e=Object(ee["a"])(["\n  mutation importChat($chatId: MongoID!) {\n    importChat(chatId: $chatId)\n  }\n"]);return $e=function(){return e},e}function je(){var e=Object(ee["a"])(["\n  query getMessages($chatid: MongoID!, $page: Int!) {\n    messages: messagePagination(\n      filter: { peer: $chatid }\n      sort: CREATEDAT_DESC\n      page: $page\n      perPage: 10\n    ) {\n      count\n      items {\n        id\n        _id\n        peer\n        from\n        fromType\n        content\n        contentFiles\n        edits\n        replyToMessageId\n        isOutgoing\n        createdAt\n        deleted\n        deletedAt\n      }\n    }\n  }\n"]);return je=function(){return e},e}var Ee=ne()(je()),De=ne()($e()),Le=ne()(Pe()),Te={data:function(){return{content:"",chatMessages:[],loading:!1,totalChatHeight:0,page:1,messages:{items:[]}}},props:["chatid"],apollo:{chatInfo:{query:Le,variables:function(){return{chatid:this.$route.params.id}},result:function(){console.log(this.chatInfo)}},messages:{query:Ee,variables:function(){return{chatid:this.$route.params.id,page:1}}}},components:{InfiniteLoading:Ie.a},computed:{chatMsgs:function(){var e=this.messages.items;return this.messages?e:[]}},methods:{importChat:function(){this.$apollo.mutate({mutation:De,variables:{chatId:this.$route.params.id}}).then((function(){}))},infiniteHandler:function(e){this.page++,this.$apollo.queries.messages.fetchMore({variables:{chatid:this.$route.params.id,page:this.page},updateQuery:function(t,n){var a=n.fetchMoreResult;return a.messages.items.length>0?e.loaded():e.complete(),{messages:{__typename:t.messages.__typename,count:t.messages.count,items:[].concat(Object(Oe["a"])(t.messages.items),Object(Oe["a"])(a.messages.items))}}}}).then((function(){}))}}},Ae=Te,Fe=(n("ac44"),n("0e8f")),Me=n("e449"),qe=n("b73d"),Re=Object(l["a"])(Ae,Ve,xe,!1,null,null,null),Ue=Re.exports;_()(Re,{VBtn:k["a"],VCard:w["a"],VCardActions:C["a"],VDivider:U["a"],VFlex:Fe["a"],VIcon:z["a"],VImg:ye["a"],VList:B["a"],VListItem:H["a"],VListItemAction:Q["a"],VListItemAvatar:ke["a"],VListItemContent:G["a"],VListItemSubtitle:G["b"],VListItemTitle:G["c"],VMenu:Me["a"],VSpacer:I["a"],VSwitch:qe["a"],VToolbar:$["a"],VToolbarTitle:j["a"]});var ze=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"chat-container"},[a("div",{staticStyle:{display:"flex","flex-direction":"column-reverse"}},e._l(e.messages,(function(t,i){var r;return a("div",{key:i,staticClass:"message",class:(r={own:t.isOutgoing,deleted:t.deleted},r[t.content._]=!0,r)},[a("div",{staticClass:"username"},[a("ApolloQuery",{attrs:{query:"User"==t.fromType?n("4ada"):n("4abe"),variables:{peer:t.from}},scopedSlots:e._u([{key:"default",fn:function(n){var i=n.result,r=i.loading,o=i.error,s=i.data;return[r?a("div",{staticClass:"loading apollo"},[e._v("Loading Name...")]):o?a("div",{staticClass:"error apollo"},[e._v("An error occurred")]):s?a("div",{staticClass:"result apollo"},[e._v(e._s(s.name.name||s.name.firstName+" "+s.name.lastName))]):a("div",{staticClass:"no-result apollo"},[e._v(e._s(t.from))])]}}],null,!0)})],1),a("div",{staticStyle:{"margin-top":"5px"}}),a("div",{staticClass:"content"},["messageText"===t.content._?a("div",{domProps:{textContent:e._s(t.content.text.text)}}):"messagePhoto"===t.content._?a("div",[a("v-img",{attrs:{src:"/api/file/"+t.contentFiles[1]}})],1):"messageSticker"===t.content._?a("div",[a("img",{attrs:{src:"/api/file/"+t.contentFiles[0]}})]):"messageVoiceNote"===t.content._?a("div",[a("audio",{attrs:{src:"/api/file/"+t.contentFiles[0],controls:""}})]):"messageVideoNote"===t.content._?a("div",[a("video",{attrs:{controls:"",poster:"/api/file/"+t.contentFiles[0],src:"/api/file/"+t.contentFiles[1]}})]):"messageAnimation"===t.content._?a("div",[a("video",{attrs:{controls:"",poster:"/api/file/"+t.contentFiles[0],src:"/api/file/"+t.contentFiles[1]}})]):"messageVideo"===t.content._?a("div",[a("video",{attrs:{controls:"",poster:"/api/file/"+t.contentFiles[0],src:"/api/file/"+(t.contentFiles[1]||t.contentFiles[0])}})]):a("div",{domProps:{innerHTML:e._s(t.content)}})])])})),0)])},Be=[];function He(){var e=Object(ee["a"])(["{\n  messages: messageMany(filter: { deleted: true }) {\n    id\n    _id\n    peer\n    from\n    fromType\n    content\n    contentFiles\n    edits\n    replyToMessageId\n    isOutgoing\n    createdAt\n    deleted\n    deletedAt\n  }\n}"]);return He=function(){return e},e}var Qe=ne()(He()),Ge={apollo:{messages:{query:Qe,pollInterval:15e3}}},Je=Ge,We=(n("80f4"),Object(l["a"])(Je,ze,Be,!1,null,null,null)),Ze=We.exports;_()(We,{VImg:ye["a"]});var Ke=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-layout",{attrs:{row:""}},["authorizationStateWaitPhoneNumber"===e.stats.telegramStatus?n("v-flex",{attrs:{sm6:""}},[n("vue-tel-input",e._b({attrs:{sm4:""},model:{value:e.phoneNumber,callback:function(t){e.phoneNumber=t},expression:"phoneNumber"}},"vue-tel-input",e.bindProps,!1)),n("v-btn",{on:{click:e.submitPhoneNumber}},[e._v("Continue")])],1):"authorizationStateWaitCode"===e.stats.telegramStatus?n("v-flex",{attrs:{sm6:""}},[n("v-col",{attrs:{cols:"12",sm:"6",md:"3"}},[n("v-text-field",{attrs:{label:"Code",placeholder:"-----",solo:""},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),n("v-btn",{on:{click:e.submitCode}},[e._v("Continue")])],1):"authorizationStateWaitPassword"===e.stats.telegramStatus?n("v-flex",{attrs:{sm6:""}},[n("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[n("v-text-field",{attrs:{label:"Password",placeholder:"***",type:"password",solo:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),n("v-btn",{on:{click:e.submitPassword}},[e._v("Continue")])],1):"authorizationStateReady"===e.stats.telegramStatus?n("v-flex",{attrs:{sm6:""}},[n("v-btn",{attrs:{to:"/"}},[e._v("Go To Dashboard")])],1):n("v-flex",{attrs:{sm6:""}},[e._v(" Invalid Authorization State: "+e._s(e.stats.telegramStatus)+" ")])],1)],1)},Xe=[],Ye=n("f62e");function et(){var e=Object(ee["a"])(["\n  mutation setupPassword($password: String!) {\n    setupPassword(password: $password) {\n      telegramStatus\n    }\n  }\n"]);return et=function(){return e},e}function tt(){var e=Object(ee["a"])(["\n  mutation setupCode($code: String!) {\n    setupCode(code: $code) {\n      telegramStatus\n    }\n  }\n"]);return tt=function(){return e},e}function nt(){var e=Object(ee["a"])(["\n  mutation setupPhoneNumber($phoneNumber: String!) {\n    setupPhoneNumber(phoneNumber: $phoneNumber) {\n      telegramStatus\n    }\n  }\n"]);return nt=function(){return e},e}function at(){var e=Object(ee["a"])(["{\n  stats {\n    telegramStatus\n  }\n}"]);return at=function(){return e},e}var it=ne()(at()),rt=ne()(nt()),ot=ne()(tt()),st=ne()(et()),lt={name:"SetupTelegram",components:{VueTelInput:Ye["a"]},apollo:{stats:{query:it,pollInterval:1e3}},data:function(){return{bindProps:{mode:"international",ignoredCountries:["in"],validCharactersOnly:!0,required:!0},phoneNumber:"",code:"",password:""}},methods:{submitPhoneNumber:function(){this.$apollo.mutate({mutation:rt,variables:{phoneNumber:this.phoneNumber}})},submitCode:function(){this.$apollo.mutate({mutation:ot,variables:{code:this.code}})},submitPassword:function(){this.$apollo.mutate({mutation:st,variables:{password:this.password}})}}},ct=lt,ut=n("a722"),dt=Object(l["a"])(ct,Ke,Xe,!1,null,null,null),vt=dt.exports;_()(dt,{VBtn:k["a"],VCol:S["a"],VContainer:V["a"],VFlex:Fe["a"],VLayout:ut["a"],VTextField:P["a"]});var pt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat-overview"},[n("v-list",{attrs:{"three-line":""}},[e._l(e.options,(function(t){return[n("v-list-item",{key:t.key},[n("v-list-item-content",[n("v-list-item-title",[e._v(" "+e._s(t.desc)+" "),n("pre",{staticStyle:{"font-size":"0.8rem"}},[e._v(e._s(t.key))])]),n("v-list-item-action",["password"===t.key?n("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},[n("v-text-field",{attrs:{type:"password",placeholder:"Specify a new Password",solo:""},model:{value:e.newPassword,callback:function(t){e.newPassword=t},expression:"newPassword"}}),n("v-btn",{on:{click:function(n){return e.changeOption(t.key,e.newPassword)}}},[e._v("Change Password(and Logout)")])],1):n("v-col",{attrs:{cols:"12",sm:"6",md:"6"}},["bool"===t.type?n("v-switch",{on:{change:function(n){return e.changeOption(t.key,t.value)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"option.value"}},[e._v("Value")]):"string"===t.type?[n("v-text-field",{attrs:{placeholder:t.default,solo:""},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"option.value"}}),n("v-btn",{on:{click:function(n){return e.changeOption(t.key,e.newPassword)}}},[e._v("Change Value")])]:"filesize"===t.type?[n("v-slider",{attrs:{step:"1048576",min:"1048576",max:"1572864000"},on:{change:function(n){return e.changeOption(t.key,t.value)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"option.value"}}),n("span",[e._v(e._s(t.value/1048576)+" MB")])]:"keepTimeDays"===t.type?[n("v-slider",{attrs:{step:"1",min:"0",max:"1000"},on:{change:function(n){return e.changeOption(t.key,t.value)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"option.value"}}),n("span",[e._v(e._s(e._f("duration")([t.value,"days"],"humanize")))])]:n("span",[e._v(e._s(t.type)+e._s(t.value))])],2)],1)],1)],1),n("v-divider",{key:t.key+"_d"})]}))],2)],1)},mt=[];function ft(){var e=Object(ee["a"])(["\n  mutation changeOption($key: String!, $value: JSON!) {\n    optionUpdateOne(filter: { key: $key }, record: { value: $value }) {\n      record {\n        key\n        type\n        default\n        desc\n        value\n      }\n    }\n  }\n"]);return ft=function(){return e},e}function ht(){var e=Object(ee["a"])(["{\n  options: optionMany {\n    _id\n    key\n    type\n    desc\n    default\n    value\n  }\n}"]);return ht=function(){return e},e}var gt=ne()(ht()),bt=ne()(ft()),_t={apollo:{options:{query:gt,pollInterval:5e3}},data:function(){return{newPassword:""}},methods:{changeOption:function(e,t){var n=this;this.$apollo.mutate({mutation:bt,variables:{key:e,value:t}}).then((function(){"password"===e&&(localStorage.clear(),n.$router.push("/login"))}))}}},yt=_t,kt=n("ba0d"),wt=Object(l["a"])(yt,pt,mt,!1,null,null,null),Ct=wt.exports;_()(wt,{VBtn:k["a"],VCol:S["a"],VDivider:U["a"],VList:B["a"],VListItem:H["a"],VListItemAction:Q["a"],VListItemContent:G["a"],VListItemTitle:G["c"],VSlider:kt["a"],VSwitch:qe["a"],VTextField:P["a"]});var St=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("iframe",{staticStyle:{width:"100%",height:"100%",overflow:"hidden"},attrs:{src:e.iframeUrl}})},Vt=[],xt={computed:{iframeUrl:function(){return"/api/interactive?Authorization="+localStorage.getItem("token")}}},Ot=xt,Nt=Object(l["a"])(Ot,St,Vt,!1,null,null,null),It=Nt.exports,Pt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("iframe",{staticStyle:{width:"100%",height:"100%",overflow:"hidden"},attrs:{src:"https://github.com/cuddlycheetah/safetygram/wiki/Help"}})},$t=[],jt={},Et=jt,Dt=Object(l["a"])(Et,Pt,$t,!1,null,null,null),Lt=Dt.exports;a["a"].use(d["a"]);var Tt=[{path:"/login",name:"Login",component:L},{path:"/",meta:{requiresAuth:!0},component:K,children:[{name:"Dashboard",path:"",component:pe},{name:"Raw Query Interface",path:"rqi",component:It},{name:"Chats",path:"chats",component:Se},{name:"Chats",path:"chats/:id",component:Ue,props:!0},{path:"deletedmsgs",component:Ze},{path:"settings",component:Ct},{path:"help",component:Lt},{path:"setup",component:vt}]}],At=new d["a"]({mode:"history",routes:Tt});At.beforeEach((function(e,t,n){e.matched.some((function(e){return e.meta.requiresAuth})),n()}));var Ft=At,Mt=n("2f62");a["a"].use(Mt["a"]);var qt=new Mt["a"].Store({state:{},mutations:{},actions:{},modules:{}}),Rt=(n("a4d3"),n("4de4"),n("4160"),n("c975"),n("e439"),n("dbb4"),n("b64b"),n("d3b7"),n("159b"),n("96cf"),n("ade3")),Ut=n("522d"),zt=n("efe7");function Bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bt(Object(n),!0).forEach((function(t){Object(Rt["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}a["a"].use(Ut["a"]);var Qt="token",Gt=Object({VUE_APP_CLI_UI_URL:"",NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_GRAPHQL_HTTP||"/api/graphql",Jt=Object({VUE_APP_CLI_UI_URL:"",NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_FILES_ROOT||Gt.substr(0,Gt.indexOf("/graphql"));a["a"].prototype.$filesRoot=Jt;var Wt={httpEndpoint:Gt,wsEndpoint:null,tokenName:Qt,persisting:!1,websocketsOnly:!1,ssr:!1};function Zt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(zt["createApolloClient"])(Ht({},Wt,{},e)),n=t.apolloClient,a=t.wsClient;n.wsClient=a;var i=new Ut["a"]({defaultClient:n,defaultOptions:{$query:{}},errorHandler:function(e){console.log("%cError","background: red; color: white; padding: 2px 4px; border-radius: 3px; font-weight: bold;",e.message)}});return i}var Kt=n("f309");a["a"].use(Kt["a"]);var Xt=new Kt["a"]({icons:{iconfont:"md"}}),Yt=n("2ead"),en=n.n(Yt);a["a"].config.productionTip=!1,new a["a"]({router:Ft,store:qt,apolloProvider:Zt(),vuetify:Xt,render:function(e){return e(u)}}).$mount("#app"),a["a"].use(en.a),a["a"].use(Ye["b"])},"80f4":function(e,t,n){"use strict";var a=n("fe62"),i=n.n(a);i.a},"88fe":function(e,t,n){},ac44:function(e,t,n){"use strict";var a=n("1a88"),i=n.n(a);i.a},fe62:function(e,t,n){}});
//# sourceMappingURL=app.780c993c.js.map